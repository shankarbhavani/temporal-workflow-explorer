# Workflow 1: Load and Email
# This workflow performs initial data loading and email sending,
# then triggers Workflow 2 for email processing

variables:
  workflow_id: ""
  run_id: ""
  search_results: ""
  email_status: ""
  sleep_result: ""
  workflow_2_result: ""
  # Load search configuration
  shipper_id: "test-qa-demo-shipper"
  agent_id: "TRACY"
  date_range_days: 30
  scac_filter: []
  mode: ["TL"]
  # Email configuration
  template_key: "test-wrapped-action-3"
  email_subject: "FourKites Alert : Late Load Follow Up"
  batching_mode: "single"
  contact_levels: ["is_level_1"]

root:
  sequence:
    elements:
      # Step 1: Search for loads
      - activity:
          name: load_search
          arguments:
            - shipper_id
            - agent_id
            - workflow_id
            - date_range_days
            - scac_filter
            - mode
          result: search_results

      # Step 2: Send email
      # Note: search_results is a dict containing loads_by_scac and load_objects
      - activity:
          name: send_email
          arguments:
            - search_results.loads_by_scac
            - search_results.load_objects
            - shipper_id
            - agent_id
            - workflow_id
            - template_key
            - email_subject
            - batching_mode
            - contact_levels
          result: email_status

      # Step 3: Wait for 10 seconds
      - activity:
          name: sleep_activity
          arguments:
            - "10"
          result: sleep_result

      # Step 4: Trigger Workflow 2
      - activity:
          name: start_child_workflow
          arguments:
            - "workflow_2_process"
          result: workflow_2_result
