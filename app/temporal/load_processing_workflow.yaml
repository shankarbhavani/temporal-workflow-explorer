# Load Processing Workflow - YAML Definition
# This workflow orchestrates the complete load handling flow:
# 1. Search for loads
# 2. Send email
# 3. Wait for 20 seconds
# 4. Process email
# 5. Extract data
# 6. Update load

variables:
  workflow_id: ""
  run_id: ""
  workflow_type: ""
  attempt: 0
  # Load search configuration
  shipper_id: "test-qa-demo-shipper"
  agent_id: "TRACY"
  date_range_days: 30
  scac_filter: []
  mode: ["TL"]
  # Email configuration
  template_key: "test-wrapped-action-3"
  email_subject: "FourKites Alert : Late Load Follow Up"
  batching_mode: "single"
  contact_levels: ["is_level_1"]

root:
  sequence:
    elements:
      # Step 1: Search for loads
      - activity:
          name: load_search
          arguments:
            - shipper_id
            - agent_id
            - workflow_id
            - date_range_days
            - scac_filter
            - mode
          result: search_results

      # Step 2: Send email
      # Note: search_results is a dict containing loads_by_scac and load_objects
      - activity:
          name: send_email
          arguments:
            - search_results.loads_by_scac
            - search_results.load_objects
            - shipper_id
            - agent_id
            - workflow_id
            - template_key
            - email_subject
            - batching_mode
            - contact_levels
          result: email_status

      # Step 3: Wait for 20 seconds
      - activity:
          name: sleep_activity
          arguments:
            - "10"
          result: sleep_result

      # Step 4: Process email
      - activity:
          name: process_email
          arguments: []
          result: classification

      # Step 5: Extract data
      - activity:
          name: extract_data
          arguments: []
          result: extracted_data

      # Step 6: Update load
      - activity:
          name: update_load
          arguments: []
          result: update_status
